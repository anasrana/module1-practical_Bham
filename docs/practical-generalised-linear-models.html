<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Practical: Generalised linear models | Essentials of Mathematics and Statistics</title>
  <meta name="description" content="This contains practicals for Module 1 (Essentials of Mathematics and Statistics)." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Practical: Generalised linear models | Essentials of Mathematics and Statistics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://anasrana.github.io/module1-practical_Bham/" />
  
  <meta property="og:description" content="This contains practicals for Module 1 (Essentials of Mathematics and Statistics)." />
  <meta name="github-repo" content="anasrana/module1-practical_Bham" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Practical: Generalised linear models | Essentials of Mathematics and Statistics" />
  
  <meta name="twitter:description" content="This contains practicals for Module 1 (Essentials of Mathematics and Statistics)." />
  

<meta name="author" content="Anas A Rana" />


<meta name="date" content="2021-10-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="practical-multiple-regression.html"/>

<script src="assets/header-attrs-2.11/header-attrs.js"></script>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Essentials of Mathematics and Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#how-to-use-these-resources"><i class="fa fa-check"></i><b>1.1</b> How to use these resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-in-r-and-rstudio.html"><a href="getting-started-in-r-and-rstudio.html"><i class="fa fa-check"></i><b>2</b> Getting started in R and Rstudio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started-in-r-and-rstudio.html"><a href="getting-started-in-r-and-rstudio.html#r-scripts"><i class="fa fa-check"></i><b>2.1</b> R scripts</a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-in-r-and-rstudio.html"><a href="getting-started-in-r-and-rstudio.html#creating-an-r-script"><i class="fa fa-check"></i><b>2.2</b> Creating an R script</a></li>
<li class="chapter" data-level="2.3" data-path="getting-started-in-r-and-rstudio.html"><a href="getting-started-in-r-and-rstudio.html#saving-an-r-script"><i class="fa fa-check"></i><b>2.3</b> Saving an R script</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started-in-r-and-rstudio.html"><a href="getting-started-in-r-and-rstudio.html#executing-code-in-an-r-script"><i class="fa fa-check"></i><b>2.4</b> Executing code in an R script</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="getting-started-in-r-and-rstudio.html"><a href="getting-started-in-r-and-rstudio.html#comments-in-an-r-script-documenting-your-code"><i class="fa fa-check"></i><b>2.4.1</b> Comments in an R script (documenting your code)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-sets.html"><a href="data-sets.html"><i class="fa fa-check"></i><b>3</b> Data sets</a></li>
<li class="chapter" data-level="4" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>4</b> Introduction</a></li>
<li class="chapter" data-level="5" data-path="simulating-random-numbers.html"><a href="simulating-random-numbers.html"><i class="fa fa-check"></i><b>5</b> Simulating random numbers</a></li>
<li class="chapter" data-level="6" data-path="markov-chains.html"><a href="markov-chains.html"><i class="fa fa-check"></i><b>6</b> Markov Chains</a></li>
<li class="chapter" data-level="" data-path="model-answers-3-state-markov-chain.html"><a href="model-answers-3-state-markov-chain.html"><i class="fa fa-check"></i>Model answers 3 state Markov Chain</a></li>
<li class="chapter" data-level="7" data-path="a-monopoly-simulation.html"><a href="a-monopoly-simulation.html"><i class="fa fa-check"></i><b>7</b> A Monopoly simulation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="a-monopoly-simulation.html"><a href="a-monopoly-simulation.html#moving-around-the-board"><i class="fa fa-check"></i><b>7.1</b> Moving around the board</a></li>
<li class="chapter" data-level="7.2" data-path="a-monopoly-simulation.html"><a href="a-monopoly-simulation.html#going-to-jail"><i class="fa fa-check"></i><b>7.2</b> Going to Jail</a></li>
<li class="chapter" data-level="7.3" data-path="a-monopoly-simulation.html"><a href="a-monopoly-simulation.html#further-exercises"><i class="fa fa-check"></i><b>7.3</b> Further Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="practical-linear-regression.html"><a href="practical-linear-regression.html"><i class="fa fa-check"></i><b>8</b> Practical: Linear regression</a>
<ul>
<li class="chapter" data-level="8.1" data-path="practical-linear-regression.html"><a href="practical-linear-regression.html#data"><i class="fa fa-check"></i><b>8.1</b> Data</a></li>
<li class="chapter" data-level="8.2" data-path="practical-linear-regression.html"><a href="practical-linear-regression.html#simulating-data"><i class="fa fa-check"></i><b>8.2</b> Simulating data</a></li>
<li class="chapter" data-level="8.3" data-path="practical-linear-regression.html"><a href="practical-linear-regression.html#fitting-simple-linear-regression-model"><i class="fa fa-check"></i><b>8.3</b> Fitting simple linear regression model</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="practical-linear-regression.html"><a href="practical-linear-regression.html#least-squared-estimation"><i class="fa fa-check"></i><b>8.3.1</b> Least squared estimation</a></li>
<li class="chapter" data-level="8.3.2" data-path="practical-linear-regression.html"><a href="practical-linear-regression.html#maximum-likelihood-estimation"><i class="fa fa-check"></i><b>8.3.2</b> Maximum likelihood estimation</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="practical-linear-regression.html"><a href="practical-linear-regression.html#effect-of-variance"><i class="fa fa-check"></i><b>8.4</b> Effect of variance</a></li>
<li class="chapter" data-level="8.5" data-path="practical-linear-regression.html"><a href="practical-linear-regression.html#exercise"><i class="fa fa-check"></i><b>8.5</b> Exercise</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="practical-linear-regression.html"><a href="practical-linear-regression.html#part-i"><i class="fa fa-check"></i><b>8.5.1</b> Part I</a></li>
<li class="chapter" data-level="8.5.2" data-path="practical-linear-regression.html"><a href="practical-linear-regression.html#part-ii"><i class="fa fa-check"></i><b>8.5.2</b> Part II</a></li>
<li class="chapter" data-level="8.5.3" data-path="practical-linear-regression.html"><a href="practical-linear-regression.html#part-iii"><i class="fa fa-check"></i><b>8.5.3</b> Part III</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-answers-linear-regression.html"><a href="model-answers-linear-regression.html"><i class="fa fa-check"></i>Model answers: Linear regression</a>
<ul>
<li class="chapter" data-level="8.6" data-path="model-answers-linear-regression.html"><a href="model-answers-linear-regression.html#exercise-i"><i class="fa fa-check"></i><b>8.6</b> Exercise I</a></li>
<li class="chapter" data-level="8.7" data-path="model-answers-linear-regression.html"><a href="model-answers-linear-regression.html#exercise-ii"><i class="fa fa-check"></i><b>8.7</b> Exercise II</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="model-answers-linear-regression.html"><a href="model-answers-linear-regression.html#comparison-of-data"><i class="fa fa-check"></i><b>8.7.1</b> Comparison of data</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="model-answers-linear-regression.html"><a href="model-answers-linear-regression.html#exercise-ii-1"><i class="fa fa-check"></i><b>8.8</b> Exercise II</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="practical-principal-component-analysis.html"><a href="practical-principal-component-analysis.html"><i class="fa fa-check"></i><b>9</b> Practical: Principal component analysis</a>
<ul>
<li class="chapter" data-level="9.1" data-path="practical-principal-component-analysis.html"><a href="practical-principal-component-analysis.html#data-1"><i class="fa fa-check"></i><b>9.1</b> Data</a></li>
<li class="chapter" data-level="9.2" data-path="practical-principal-component-analysis.html"><a href="practical-principal-component-analysis.html#introduction-2"><i class="fa fa-check"></i><b>9.2</b> Introduction</a></li>
<li class="chapter" data-level="9.3" data-path="practical-principal-component-analysis.html"><a href="practical-principal-component-analysis.html#exercise-i-1"><i class="fa fa-check"></i><b>9.3</b> Exercise I</a></li>
<li class="chapter" data-level="9.4" data-path="practical-principal-component-analysis.html"><a href="practical-principal-component-analysis.html#exercise-ii-2"><i class="fa fa-check"></i><b>9.4</b> Exercise II</a></li>
<li class="chapter" data-level="9.5" data-path="practical-principal-component-analysis.html"><a href="practical-principal-component-analysis.html#exercise-iii"><i class="fa fa-check"></i><b>9.5</b> Exercise III</a></li>
<li class="chapter" data-level="9.6" data-path="practical-principal-component-analysis.html"><a href="practical-principal-component-analysis.html#exercise-iv-single-cell-data"><i class="fa fa-check"></i><b>9.6</b> Exercise IV: Single cell data</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="practical-multiple-regression.html"><a href="practical-multiple-regression.html"><i class="fa fa-check"></i><b>10</b> Practical: Multiple regression</a>
<ul>
<li class="chapter" data-level="10.1" data-path="practical-multiple-regression.html"><a href="practical-multiple-regression.html#multiple-regression"><i class="fa fa-check"></i><b>10.1</b> Multiple regression</a></li>
<li class="chapter" data-level="10.2" data-path="practical-multiple-regression.html"><a href="practical-multiple-regression.html#categorical-covariates"><i class="fa fa-check"></i><b>10.2</b> Categorical covariates</a></li>
<li class="chapter" data-level="10.3" data-path="practical-multiple-regression.html"><a href="practical-multiple-regression.html#residuals"><i class="fa fa-check"></i><b>10.3</b> Residuals</a></li>
<li class="chapter" data-level="10.4" data-path="practical-multiple-regression.html"><a href="practical-multiple-regression.html#gradient-descent-algorithm"><i class="fa fa-check"></i><b>10.4</b> Gradient descent algorithm (+)</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="practical-generalised-linear-models.html"><a href="practical-generalised-linear-models.html"><i class="fa fa-check"></i><b>11</b> Practical: Generalised linear models</a>
<ul>
<li class="chapter" data-level="11.1" data-path="practical-generalised-linear-models.html"><a href="practical-generalised-linear-models.html#data-2"><i class="fa fa-check"></i><b>11.1</b> Data</a></li>
<li class="chapter" data-level="11.2" data-path="practical-generalised-linear-models.html"><a href="practical-generalised-linear-models.html#detecting-snp-associations"><i class="fa fa-check"></i><b>11.2</b> Detecting SNP associations</a></li>
<li class="chapter" data-level="11.3" data-path="practical-generalised-linear-models.html"><a href="practical-generalised-linear-models.html#gwas-and-logistic-regression"><i class="fa fa-check"></i><b>11.3</b> GWAS and logistic regression</a></li>
<li class="chapter" data-level="11.4" data-path="practical-generalised-linear-models.html"><a href="practical-generalised-linear-models.html#negative-binomial-and-poisson-regression"><i class="fa fa-check"></i><b>11.4</b> Negative binomial and Poisson regression</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="practical-generalised-linear-models.html"><a href="practical-generalised-linear-models.html#count-based-glms"><i class="fa fa-check"></i><b>11.4.1</b> Count-based GLMs</a></li>
<li class="chapter" data-level="11.4.2" data-path="practical-generalised-linear-models.html"><a href="practical-generalised-linear-models.html#fitting-a-glm"><i class="fa fa-check"></i><b>11.4.2</b> Fitting a GLM</a></li>
<li class="chapter" data-level="11.4.3" data-path="practical-generalised-linear-models.html"><a href="practical-generalised-linear-models.html#comparing-nested-models"><i class="fa fa-check"></i><b>11.4.3</b> Comparing nested models</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="practical-generalised-linear-models.html"><a href="practical-generalised-linear-models.html#negative-binomial-vs-poisson-glms"><i class="fa fa-check"></i><b>11.5</b> Negative-Binomial vs Poisson GLMs</a></li>
<li class="chapter" data-level="11.6" data-path="practical-generalised-linear-models.html"><a href="practical-generalised-linear-models.html#further-understanding-the-model-optional"><i class="fa fa-check"></i><b>11.6</b> Further understanding the model (<strong>OPTIONAL</strong>)</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Essentials of Mathematics and Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="practical-generalised-linear-models" class="section level1" number="11">
<h1><span class="header-section-number">11</span> Practical: Generalised linear models</h1>
<p>In a genome-wide association study, we perform an experiment where we select <span class="math inline">\(n\)</span> individuals with a disease (cases) and <span class="math inline">\(n\)</span> individuals without the diseases (controls) and look for genetic differences between these two groups. In particular, we are interested in specific genetic variants (SNPs) that might induce some predisposition towards the disease.</p>
<p>Suppose I observe the following genotypes for a SNP in 4,000 individuals (2,000 cases, 2,000 controls):</p>
<ul>
<li>Genotypes: <code>AA</code> <code>Aa</code> <code>aa</code></li>
<li>Controls: <code>3 209 1788</code></li>
<li>Cases: <code>83 621 1296</code></li>
</ul>
<p>The cases seem to have relatively more <code>A</code> alleles than the controls. This might make us suspect that having <code>A</code> alleles at this SNP is associated with the disease.</p>
<div id="data-2" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> Data</h2>
<p>For this practical we will use two files you can use these links to download them:</p>
<ul>
<li><code>gwas-cc-ex1.Rdata</code> (<a href="https://raw.github.com/anasrana/module1-practical_Bham/master/data/gwas-cc-ex1.Rdata">download</a>)</li>
<li><code>gwas-cc-ex2.Rdata</code> (<a href="https://raw.github.com/anasrana/module1-practical_Bham/master/data/gwas-cc-ex2.Rdata">download</a>)</li>
<li><code>nb_data.Rdata</code> (<a href="https://raw.github.com/anasrana/module1-practical_Bham/master/data/nb_data.Rdata">download</a>)</li>
</ul>
</div>
<div id="detecting-snp-associations" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> Detecting SNP associations</h2>
<p>We have seen in lectures that we can do statistical tests for this type of contingency table using Chi Squared Tests. Let’s load example data set and and prepare</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="practical-generalised-linear-models.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># for plots later</span></span>
<span id="cb116-2"><a href="practical-generalised-linear-models.html#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;gwas-cc-ex1.Rdata&quot;</span>)</span>
<span id="cb116-3"><a href="practical-generalised-linear-models.html#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="practical-generalised-linear-models.html#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="co"># how many individuals are there</span></span>
<span id="cb116-5"><a href="practical-generalised-linear-models.html#cb116-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb116-6"><a href="practical-generalised-linear-models.html#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="co"># How many SNPs do we have data for</span></span>
<span id="cb116-7"><a href="practical-generalised-linear-models.html#cb116-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb116-8"><a href="practical-generalised-linear-models.html#cb116-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-9"><a href="practical-generalised-linear-models.html#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="co"># samples that are controls are encoded as 0 in y</span></span>
<span id="cb116-10"><a href="practical-generalised-linear-models.html#cb116-10" aria-hidden="true" tabindex="-1"></a>control <span class="ot">&lt;-</span> <span class="fu">which</span>(y <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb116-11"><a href="practical-generalised-linear-models.html#cb116-11" aria-hidden="true" tabindex="-1"></a><span class="co"># disease cases are encoded as 1 in y</span></span>
<span id="cb116-12"><a href="practical-generalised-linear-models.html#cb116-12" aria-hidden="true" tabindex="-1"></a>cases <span class="ot">&lt;-</span> <span class="fu">which</span>(y <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Now we need to write a loop that scans through all, <span class="math inline">\(p\)</span>, SNPs:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="practical-generalised-linear-models.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a vector where p-values will be stored</span></span>
<span id="cb117-2"><a href="practical-generalised-linear-models.html#cb117-2" aria-hidden="true" tabindex="-1"></a>p_vals <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, p)</span>
<span id="cb117-3"><a href="practical-generalised-linear-models.html#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="practical-generalised-linear-models.html#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over SNPs</span></span>
<span id="cb117-5"><a href="practical-generalised-linear-models.html#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p) {</span>
<span id="cb117-6"><a href="practical-generalised-linear-models.html#cb117-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. obtain genotype counts</span></span>
<span id="cb117-7"><a href="practical-generalised-linear-models.html#cb117-7" aria-hidden="true" tabindex="-1"></a>    counts <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb117-8"><a href="practical-generalised-linear-models.html#cb117-8" aria-hidden="true" tabindex="-1"></a>    counts[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sum</span>(X[i_p, control] <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb117-9"><a href="practical-generalised-linear-models.html#cb117-9" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">sum</span>(X[i_p, control] <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb117-10"><a href="practical-generalised-linear-models.html#cb117-10" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">sum</span>(X[i_p, control] <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb117-11"><a href="practical-generalised-linear-models.html#cb117-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-12"><a href="practical-generalised-linear-models.html#cb117-12" aria-hidden="true" tabindex="-1"></a>    counts[<span class="dv">2</span>, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sum</span>(X[i_p, cases] <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb117-13"><a href="practical-generalised-linear-models.html#cb117-13" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">sum</span>(X[i_p, cases] <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb117-14"><a href="practical-generalised-linear-models.html#cb117-14" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">sum</span>(X[i_p, cases] <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb117-15"><a href="practical-generalised-linear-models.html#cb117-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-16"><a href="practical-generalised-linear-models.html#cb117-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. expected probability of AA</span></span>
<span id="cb117-17"><a href="practical-generalised-linear-models.html#cb117-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (assuming no dependence on case/control status)</span></span>
<span id="cb117-18"><a href="practical-generalised-linear-models.html#cb117-18" aria-hidden="true" tabindex="-1"></a>    expected_pr_AA <span class="ot">&lt;-</span> <span class="fu">sum</span>(counts[, <span class="dv">1</span>]) <span class="sc">/</span> n</span>
<span id="cb117-19"><a href="practical-generalised-linear-models.html#cb117-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># expected probability of Aa</span></span>
<span id="cb117-20"><a href="practical-generalised-linear-models.html#cb117-20" aria-hidden="true" tabindex="-1"></a>    expected_pr_Aa <span class="ot">&lt;-</span> <span class="fu">sum</span>(counts[, <span class="dv">2</span>]) <span class="sc">/</span> n</span>
<span id="cb117-21"><a href="practical-generalised-linear-models.html#cb117-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># expected probability of aa</span></span>
<span id="cb117-22"><a href="practical-generalised-linear-models.html#cb117-22" aria-hidden="true" tabindex="-1"></a>    expected_pr_aa <span class="ot">&lt;-</span> <span class="fu">sum</span>(counts[, <span class="dv">3</span>]) <span class="sc">/</span> n</span>
<span id="cb117-23"><a href="practical-generalised-linear-models.html#cb117-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-24"><a href="practical-generalised-linear-models.html#cb117-24" aria-hidden="true" tabindex="-1"></a>    expected_probs <span class="ot">&lt;-</span> <span class="fu">c</span>(expected_pr_AA, expected_pr_Aa, expected_pr_aa )</span>
<span id="cb117-25"><a href="practical-generalised-linear-models.html#cb117-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-26"><a href="practical-generalised-linear-models.html#cb117-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. do my chi-squared test</span></span>
<span id="cb117-27"><a href="practical-generalised-linear-models.html#cb117-27" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(counts, <span class="at">p =</span> expected_probs)</span>
<span id="cb117-28"><a href="practical-generalised-linear-models.html#cb117-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract p value of test and store</span></span>
<span id="cb117-29"><a href="practical-generalised-linear-models.html#cb117-29" aria-hidden="true" tabindex="-1"></a>    p_vals[i_p] <span class="ot">&lt;-</span> out<span class="sc">$</span>p.value</span>
<span id="cb117-30"><a href="practical-generalised-linear-models.html#cb117-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We went through each SNP (rows in matrix <code>X</code>), extracted the counts of each genotype (marked <code>1.</code> in code) for cases and controls, then we compute expected probability (marked <code>2.</code> in code). Finally, we perform a chi-squared contingency table test comparing those observed counts to expected probabilities assuming that genotype is not related to disease status (marked <code>3.</code> in code).</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="practical-generalised-linear-models.html#cb118-1" aria-hidden="true" tabindex="-1"></a>p_val_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">p_val =</span> p_vals, <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb118-2"><a href="practical-generalised-linear-models.html#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="practical-generalised-linear-models.html#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_val_df, <span class="fu">aes</span>(<span class="at">x =</span> idx, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(p_val))) <span class="sc">+</span></span>
<span id="cb118-4"><a href="practical-generalised-linear-models.html#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">col =</span> <span class="st">&quot;dodgerblue1&quot;</span>)</span></code></pre></div>
<p><img src="Practicals-module_1_files/figure-html/plot-1.png" width="3000" /></p>
<p>This plot is knows as a <em>Manhattan</em> plot. One SNP (<code>i_p = 250</code>) will pop out as being highly associated with the disease process. Look at the genotype counts (or MAF) for this SNP in the cases and controls to see for yourself that there is large difference in the distribution of genotypes (or MAF).</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="practical-generalised-linear-models.html#cb119-1" aria-hidden="true" tabindex="-1"></a>i_p <span class="ot">&lt;-</span> <span class="dv">250</span></span>
<span id="cb119-2"><a href="practical-generalised-linear-models.html#cb119-2" aria-hidden="true" tabindex="-1"></a>counts_v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sum</span>(X[i_p, control] <span class="sc">==</span> <span class="dv">0</span>), <span class="fu">sum</span>(X[i_p, control] <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb119-3"><a href="practical-generalised-linear-models.html#cb119-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">sum</span>(X[i_p, control] <span class="sc">==</span> <span class="dv">2</span>), <span class="fu">sum</span>(X[i_p, cases] <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb119-4"><a href="practical-generalised-linear-models.html#cb119-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">sum</span>(X[i_p, cases] <span class="sc">==</span> <span class="dv">1</span>), <span class="fu">sum</span>(X[i_p, cases] <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb119-5"><a href="practical-generalised-linear-models.html#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="practical-generalised-linear-models.html#cb119-6" aria-hidden="true" tabindex="-1"></a>snp_procs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(counts_v, <span class="at">type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;control&quot;</span>, <span class="st">&quot;cases&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb119-7"><a href="practical-generalised-linear-models.html#cb119-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">genotype =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;AA&quot;</span>, <span class="st">&quot;Aa&quot;</span>, <span class="st">&quot;aa&quot;</span>), <span class="dv">2</span>))</span>
<span id="cb119-8"><a href="practical-generalised-linear-models.html#cb119-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-9"><a href="practical-generalised-linear-models.html#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(snp_procs, <span class="fu">aes</span>(<span class="at">x =</span> genotype, <span class="at">y =</span> counts_v, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb119-10"><a href="practical-generalised-linear-models.html#cb119-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="Practicals-module_1_files/figure-html/snp-1.png" width="2400" /></p>
</div>
<div id="gwas-and-logistic-regression" class="section level2" number="11.3">
<h2><span class="header-section-number">11.3</span> GWAS and logistic regression</h2>
<p>Now lets approach this problem using Generalised Linear Models. Lets load a data set containing genotypes in <code>X</code> and case-control status in <code>y</code>:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="practical-generalised-linear-models.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load an example data set (genotypes in X, case-control (1/0) status in y)</span></span>
<span id="cb120-2"><a href="practical-generalised-linear-models.html#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;gwas-cc-ex2.Rdata&quot;</span>)</span>
<span id="cb120-3"><a href="practical-generalised-linear-models.html#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="practical-generalised-linear-models.html#cb120-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(y) <span class="co"># how many individuals do we have in total?</span></span>
<span id="cb120-5"><a href="practical-generalised-linear-models.html#cb120-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X) <span class="co"># how many SNPs do I have data for?</span></span></code></pre></div>
<p>For each of the <code>p</code> SNPs we are going to call the <code>R</code> GLM function <code>glm</code> using the <code>binomial</code> family option with the <code>logit</code> link function because my outcomes are binary. We will then extract the p-value associated with the regression coefficient for the genotype. This is obtained from applying a hypothesis test (the <em>Wald Test</em>) on whether the coefficient has a null value zero.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="practical-generalised-linear-models.html#cb121-1" aria-hidden="true" tabindex="-1"></a>p_vals <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, p)</span>
<span id="cb121-2"><a href="practical-generalised-linear-models.html#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p ) {</span>
<span id="cb121-3"><a href="practical-generalised-linear-models.html#cb121-3" aria-hidden="true" tabindex="-1"></a>  snp_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> y, <span class="at">x =</span> X[j, ])</span>
<span id="cb121-4"><a href="practical-generalised-linear-models.html#cb121-4" aria-hidden="true" tabindex="-1"></a>  glm.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> logit), <span class="at">data =</span> snp_data  )</span>
<span id="cb121-5"><a href="practical-generalised-linear-models.html#cb121-5" aria-hidden="true" tabindex="-1"></a>  p_vals[j] <span class="ot">&lt;-</span> <span class="fu">summary</span>(glm.fit)<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>]</span>
<span id="cb121-6"><a href="practical-generalised-linear-models.html#cb121-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We are testing 1,000 SNPs so lets use Bonferroni correction to adjust these p-values to take into account multiple testing:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="practical-generalised-linear-models.html#cb122-1" aria-hidden="true" tabindex="-1"></a>adj_p_vals <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_vals, <span class="st">&quot;bonferroni&quot;</span>)</span></code></pre></div>
<p>Lets use the adjusted -log10 p-values to plot a Manhattan plot:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="practical-generalised-linear-models.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create data.frame with p-values for plotting with ggplot</span></span>
<span id="cb123-2"><a href="practical-generalised-linear-models.html#cb123-2" aria-hidden="true" tabindex="-1"></a>p_val_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">p_val =</span> adj_p_vals, <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb123-3"><a href="practical-generalised-linear-models.html#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="practical-generalised-linear-models.html#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_val_df, <span class="fu">aes</span>(<span class="at">x =</span> idx, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(p_val))) <span class="sc">+</span></span>
<span id="cb123-5"><a href="practical-generalised-linear-models.html#cb123-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">col =</span> <span class="st">&quot;dodgerblue1&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-6"><a href="practical-generalised-linear-models.html#cb123-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;-log10(adjusted p-value)&quot;</span>)</span></code></pre></div>
<p><img src="Practicals-module_1_files/figure-html/gwas2_plot-1.png" width="2100" /></p>
<p>You should see a single SNP showing a strong association with disease status.</p>
</div>
<div id="negative-binomial-and-poisson-regression" class="section level2" number="11.4">
<h2><span class="header-section-number">11.4</span> Negative binomial and Poisson regression</h2>
<p>Molecular biologists study the behavior of protein expression in normal and cancerous tissues. The hypothesis is that the total number of over-expressed proteins depends on the histopathological-derived tumor subtype and an immune cell contexture measure.</p>
<p>You are provided with data on 314 tumours in the file <code>nb_data.Rdata</code>. The file contains one <code>data frame</code> with the following variables:</p>
<ul>
<li><strong><code>overexpressed_proteins</code></strong>: response variable of interest.</li>
<li><strong><code>immunoscore</code></strong>: gives a standardized measure of immune cell contexture.</li>
<li><strong><code>tumor_subtype</code></strong>: three-level nominal variable indicating the histopathological sub-type of the tumour. The three levels are Unstable, Stable, and Complex</li>
</ul>
<p>Let’s load some prerequisite R libraries and the data to produce some summary statistics (<em>install if required using <code>install.package()</code> command</em> ):</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="practical-generalised-linear-models.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># required libraries</span></span>
<span id="cb124-2"><a href="practical-generalised-linear-models.html#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb124-3"><a href="practical-generalised-linear-models.html#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb124-4"><a href="practical-generalised-linear-models.html#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="practical-generalised-linear-models.html#cb124-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-6"><a href="practical-generalised-linear-models.html#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;nb_data.Rdata&quot;</span>)</span>
<span id="cb124-7"><a href="practical-generalised-linear-models.html#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="practical-generalised-linear-models.html#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print summary statistics to Console</span></span>
<span id="cb124-9"><a href="practical-generalised-linear-models.html#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat)</span></code></pre></div>
<pre><code>##    sample_id      gender     immunoscore    overexpressed_proteins  tumor_subtype
##  1001   :  1   female:160   Min.   : 1.00   Min.   : 0.000         Complex : 40  
##  1002   :  1   male  :154   1st Qu.:28.00   1st Qu.: 1.000         Unstable:167  
##  1003   :  1                Median :48.00   Median : 4.000         Stable  :107  
##  1004   :  1                Mean   :48.27   Mean   : 5.955                       
##  1005   :  1                3rd Qu.:70.00   3rd Qu.: 8.000                       
##  1006   :  1                Max.   :99.00   Max.   :35.000                       
##  (Other):308</code></pre>
<div id="count-based-glms" class="section level3" number="11.4.1">
<h3><span class="header-section-number">11.4.1</span> Count-based GLMs</h3>
<p>The <code>overexpressed_proteins</code> measurements are counts. This implies we should use a Poisson based GLM.</p>
<p>In Poisson regression models, the conditional variance is by definition equal to the conditional mean. This can be limiting.</p>
<p><em>Negative binomial regression</em> can be used for over-dispersed count data, that is when the conditional variance exceeds the conditional mean.</p>
<p>It can be considered as a generalization of Poisson regression since it has the same mean structure as Poisson regression but it has an extra parameter to model the over-dispersion. If the conditional distribution of the outcome variable is over-dispersed, the confidence intervals for the Poisson regression are likely to be narrower as compared to those from a Negative Binomial regression model.</p>
<p>In the following we will try both models to see which fits best.</p>
</div>
<div id="fitting-a-glm" class="section level3" number="11.4.2">
<h3><span class="header-section-number">11.4.2</span> Fitting a GLM</h3>
<p>Below we use the <code>glm.nb</code> function from the <code>MASS</code> package to estimate a negative binomial regression. The use of the function is similar to that of <code>lm</code> for linear models but with the additional requirement of a link function. As count data is always positive, a log link function is useful here.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="practical-generalised-linear-models.html#cb126-1" aria-hidden="true" tabindex="-1"></a>glm_1 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(overexpressed_proteins <span class="sc">~</span> immunoscore <span class="sc">+</span> tumor_subtype <span class="sc">+</span> gender, <span class="at">data =</span> dat, <span class="at">link=</span>log)</span>
<span id="cb126-2"><a href="practical-generalised-linear-models.html#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="practical-generalised-linear-models.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print summary statistics of glm.nb output object to Console</span></span>
<span id="cb126-4"><a href="practical-generalised-linear-models.html#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm_1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm.nb(formula = overexpressed_proteins ~ immunoscore + tumor_subtype + 
##     gender, data = dat, link = log, init.theta = 1.047288915)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.1567  -1.0761  -0.3810   0.2856   2.7235  
## 
## Coefficients:
##                        Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)            2.707484   0.204275  13.254  &lt; 2e-16 ***
## immunoscore           -0.006236   0.002492  -2.502   0.0124 *  
## tumor_subtypeUnstable -0.424540   0.181725  -2.336   0.0195 *  
## tumor_subtypeStable   -1.252615   0.199699  -6.273 3.55e-10 ***
## gendermale            -0.211086   0.121989  -1.730   0.0836 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Negative Binomial(1.0473) family taken to be 1)
## 
##     Null deviance: 431.67  on 313  degrees of freedom
## Residual deviance: 358.87  on 309  degrees of freedom
## AIC: 1740.3
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  1.047 
##           Std. Err.:  0.108 
## 
##  2 x log-likelihood:  -1728.307</code></pre>
<p>R first displays the call and the deviance residuals. Next, we see the regression coefficients for each of the variables, along with standard errors, z-scores, and p-values. The variable <code>immunoscore</code> has a coefficient of -0.006, which is statistically significant at the 5% level (<code>Pr(&gt;|z|) = 0.0124*</code>). This means that for each one-unit increase in <code>immunoscore</code>, the expected log count of the number of <code>overexpressed_proteins</code> decreases by 0.006.</p>
<p>The indicator variable shown as <code>tumor_subtypeUnstable</code> is the expected difference in log count between group Unstable and the reference group (<code>tumor_subtype=Complex</code>). The expected log count for the Unstable type is approximately 0.4 lower than the expected log count for the Complex type.</p>
<p>The indicator variable for Stable type is the expected difference in log count between the Stable type and the reference Complex group. The expected log count for Stable is approximately 1.2 lower than the expected log count for the Complex type.</p>
</div>
<div id="comparing-nested-models" class="section level3" number="11.4.3">
<h3><span class="header-section-number">11.4.3</span> Comparing nested models</h3>
<p>To determine if <code>tumor_subtype</code> itself, overall, is statistically significant, we can compare a model with and without <code>tumor_subtype</code>. The reason it is important to fit separate models is that, unless we do, the overdispersion parameter is held constant and it would not be a fair comparison.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="practical-generalised-linear-models.html#cb128-1" aria-hidden="true" tabindex="-1"></a>glm_2 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(overexpressed_proteins <span class="sc">~</span> immunoscore <span class="sc">+</span> gender, <span class="at">data =</span> dat, <span class="at">link =</span> log)</span></code></pre></div>
<p>We use the <code>anova</code> function to compare models using a likelihood ratio test (LRT):</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="practical-generalised-linear-models.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(glm_1, glm_2, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in anova.negbin(glm_1, glm_2, test = &quot;LRT&quot;): only Chi-squared LR tests are implemented</code></pre>
<pre><code>## Likelihood ratio tests of Negative Binomial Models
## 
## Response: overexpressed_proteins
##                                  Model     theta Resid. df    2 x log-lik.   Test    df
## 1                 immunoscore + gender 0.8705939       311       -1772.074             
## 2 immunoscore + tumor_subtype + gender 1.0472889       309       -1728.307 1 vs 2     2
##   LR stat.      Pr(Chi)
## 1                      
## 2 43.76737 3.133546e-10</code></pre>
<p>The two degree-of-freedom chi-square test indicates that <code>tumor_subtype</code> is a statistically significant predictor of <code>overexpressed_proteins</code> (<code>Pr(Chi) = 3.133546e-10</code>).</p>
<p>The <code>anova</code> function performs a form of <em>LRT</em>. It computes the likelihood of the data under the two models being compared and then uses the ration of these likelihood values as a test statistic.</p>
<p>Theory tells us that, for large samples sizes, the (2x) log likelihood ratio has a chi-squared distribution with degrees of freedom equal to the difference in the number of free parameters between the two models being compared. The LRT only applies to <em>nested models</em>, i.e. a pair of models where one is a less complex subset of the other.</p>
</div>
</div>
<div id="negative-binomial-vs-poisson-glms" class="section level2" number="11.5">
<h2><span class="header-section-number">11.5</span> Negative-Binomial vs Poisson GLMs</h2>
<p>Negative binomial models assume the conditional means are not equal to the conditional variances. This inequality is captured by estimating a dispersion parameter (not shown in the output) that is held constant in a Poisson model. Thus, the Poisson model is actually nested in the negative binomial model. We can then use a likelihood ratio test to compare these two models.</p>
<p>To do this, we will first fit a GLM Poisson regression:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="practical-generalised-linear-models.html#cb132-1" aria-hidden="true" tabindex="-1"></a>glm_3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(overexpressed_proteins <span class="sc">~</span> immunoscore <span class="sc">+</span> tumor_subtype <span class="sc">+</span> gender, <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">data =</span> dat)</span></code></pre></div>
<p>Now, lets do our likelihood ratio test, we can extract the log-likelihood using <code>logLik()</code> and then use <code>pchisq()</code> to extract the probability of getting a statistic at least as extreme as this:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="practical-generalised-linear-models.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(<span class="dv">2</span> <span class="sc">*</span> (<span class="fu">logLik</span>(glm_1) <span class="sc">-</span> <span class="fu">logLik</span>(glm_3)), <span class="at">df =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## &#39;log Lik.&#39; 3.847622e-198 (df=6)</code></pre>
<p>Note that the more complex model goes first because more complex models always have the larger likelihood.</p>
<p>In this example the associated chi-squared value estimated from <code>2*(logLik(m1) – logLik(m3))</code> is around 900 with one degree of freedom. This strongly suggests the negative binomial model, estimating the dispersion parameter, is more appropriate than the Poisson model.</p>
</div>
<div id="further-understanding-the-model-optional" class="section level2" number="11.6">
<h2><span class="header-section-number">11.6</span> Further understanding the model (<strong>OPTIONAL</strong>)</h2>
<p>For assistance in further understanding the model, we can look at predicted counts for various levels of our predictors. Below we create new datasets with values of <code>immunoscore</code> and <code>tumor_subtype</code> and then use the predict command to calculate the predicted number of overexpressed proteins</p>
<p>First, we can look at predicted counts for each value of <code>tumor_subtype</code> while holding <code>immunoscore</code> at its mean. To do this, we create a new dataset with the combinations of <code>tumor_subtype</code> and <code>immunoscore</code> for which we would like to find predicted values, then use the <code>predict()</code> command.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="practical-generalised-linear-models.html#cb135-1" aria-hidden="true" tabindex="-1"></a>newdata_1 <span class="ot">&lt;-</span></span>
<span id="cb135-2"><a href="practical-generalised-linear-models.html#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb135-3"><a href="practical-generalised-linear-models.html#cb135-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">immunoscore =</span> <span class="fu">mean</span>(dat<span class="sc">$</span>immunoscore),</span>
<span id="cb135-4"><a href="practical-generalised-linear-models.html#cb135-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tumor_subtype =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;Complex&quot;</span>, <span class="st">&quot;Unstable&quot;</span>, <span class="st">&quot;Stable&quot;</span>), <span class="at">labels =</span> <span class="fu">levels</span>(dat<span class="sc">$</span>tumor_subtype)),</span>
<span id="cb135-5"><a href="practical-generalised-linear-models.html#cb135-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender=</span><span class="st">&quot;male&quot;</span>)</span>
<span id="cb135-6"><a href="practical-generalised-linear-models.html#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="practical-generalised-linear-models.html#cb135-7" aria-hidden="true" tabindex="-1"></a>newdata_2 <span class="ot">&lt;-</span></span>
<span id="cb135-8"><a href="practical-generalised-linear-models.html#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb135-9"><a href="practical-generalised-linear-models.html#cb135-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">immunoscore =</span> <span class="fu">mean</span>(dat<span class="sc">$</span>immunoscore),</span>
<span id="cb135-10"><a href="practical-generalised-linear-models.html#cb135-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">tumor_subtype =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;Complex&quot;</span>, <span class="st">&quot;Unstable&quot;</span>, <span class="st">&quot;Stable&quot;</span>), <span class="at">labels =</span> <span class="fu">levels</span>(dat<span class="sc">$</span>tumor_subtype)),</span>
<span id="cb135-11"><a href="practical-generalised-linear-models.html#cb135-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender=</span><span class="st">&quot;female&quot;</span>)</span>
<span id="cb135-12"><a href="practical-generalised-linear-models.html#cb135-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-13"><a href="practical-generalised-linear-models.html#cb135-13" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(newdata_1, newdata_2)</span>
<span id="cb135-14"><a href="practical-generalised-linear-models.html#cb135-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-15"><a href="practical-generalised-linear-models.html#cb135-15" aria-hidden="true" tabindex="-1"></a>new_data<span class="sc">$</span>phat <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm_1, new_data, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb135-16"><a href="practical-generalised-linear-models.html#cb135-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-17"><a href="practical-generalised-linear-models.html#cb135-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(new_data)</span></code></pre></div>
<pre><code>##   immunoscore tumor_subtype gender      phat
## 1    48.26752       Complex   male  8.983829
## 2    48.26752        Stable   male  2.567187
## 3    48.26752      Unstable   male  5.876060
## 4    48.26752       Complex female 11.095193
## 5    48.26752        Stable female  3.170523
## 6    48.26752      Unstable female  7.257042</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="practical-generalised-linear-models.html#cb137-1" aria-hidden="true" tabindex="-1"></a>newdata_3 <span class="ot">&lt;-</span></span>
<span id="cb137-2"><a href="practical-generalised-linear-models.html#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb137-3"><a href="practical-generalised-linear-models.html#cb137-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">immunoscore =</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>immunoscore), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>immunoscore), <span class="at">length.out =</span> <span class="dv">100</span>), <span class="dv">3</span>),</span>
<span id="cb137-4"><a href="practical-generalised-linear-models.html#cb137-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tumor_subtype =</span> <span class="fu">rep</span>(<span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;Complex&quot;</span>, <span class="st">&quot;Unstable&quot;</span>, <span class="st">&quot;Stable&quot;</span>), <span class="at">labels =</span> <span class="fu">levels</span>(dat<span class="sc">$</span>tumor_subtype)), <span class="at">each=</span><span class="dv">100</span>),</span>
<span id="cb137-5"><a href="practical-generalised-linear-models.html#cb137-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender=</span><span class="st">&quot;male&quot;</span>)</span>
<span id="cb137-6"><a href="practical-generalised-linear-models.html#cb137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-7"><a href="practical-generalised-linear-models.html#cb137-7" aria-hidden="true" tabindex="-1"></a>newdata_4 <span class="ot">&lt;-</span></span>
<span id="cb137-8"><a href="practical-generalised-linear-models.html#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb137-9"><a href="practical-generalised-linear-models.html#cb137-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">immunoscore =</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>immunoscore), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>immunoscore), <span class="at">length.out =</span> <span class="dv">100</span>), <span class="dv">3</span>),</span>
<span id="cb137-10"><a href="practical-generalised-linear-models.html#cb137-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">tumor_subtype =</span> <span class="fu">rep</span>(<span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;Complex&quot;</span>, <span class="st">&quot;Unstable&quot;</span>, <span class="st">&quot;Stable&quot;</span>), <span class="at">labels =</span> <span class="fu">levels</span>(dat<span class="sc">$</span>tumor_subtype)), <span class="at">each=</span><span class="dv">100</span>),</span>
<span id="cb137-11"><a href="practical-generalised-linear-models.html#cb137-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender=</span><span class="st">&quot;female&quot;</span>)</span>
<span id="cb137-12"><a href="practical-generalised-linear-models.html#cb137-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-13"><a href="practical-generalised-linear-models.html#cb137-13" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(newdata_3, newdata_4)</span>
<span id="cb137-14"><a href="practical-generalised-linear-models.html#cb137-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-15"><a href="practical-generalised-linear-models.html#cb137-15" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(new_data, <span class="fu">predict</span>(glm_1, new_data, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>))</span>
<span id="cb137-16"><a href="practical-generalised-linear-models.html#cb137-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-17"><a href="practical-generalised-linear-models.html#cb137-17" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">within</span>(new_data, {</span>
<span id="cb137-18"><a href="practical-generalised-linear-models.html#cb137-18" aria-hidden="true" tabindex="-1"></a>  overexpressed_proteins <span class="ot">&lt;-</span> <span class="fu">exp</span>(fit)</span>
<span id="cb137-19"><a href="practical-generalised-linear-models.html#cb137-19" aria-hidden="true" tabindex="-1"></a>  LL <span class="ot">&lt;-</span> <span class="fu">exp</span>(fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit)</span>
<span id="cb137-20"><a href="practical-generalised-linear-models.html#cb137-20" aria-hidden="true" tabindex="-1"></a>  UL <span class="ot">&lt;-</span> <span class="fu">exp</span>(fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit)</span>
<span id="cb137-21"><a href="practical-generalised-linear-models.html#cb137-21" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="practical-generalised-linear-models.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb138-2"><a href="practical-generalised-linear-models.html#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="practical-generalised-linear-models.html#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_data, <span class="fu">aes</span>(immunoscore, overexpressed_proteins)) <span class="sc">+</span></span>
<span id="cb138-4"><a href="practical-generalised-linear-models.html#cb138-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> LL, <span class="at">ymax =</span> UL, <span class="at">fill =</span> tumor_subtype), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb138-5"><a href="practical-generalised-linear-models.html#cb138-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour =</span> tumor_subtype), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb138-6"><a href="practical-generalised-linear-models.html#cb138-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Immunoscore&quot;</span>,</span>
<span id="cb138-7"><a href="practical-generalised-linear-models.html#cb138-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;Overexpressed Proteins&quot;</span>) <span class="sc">+</span></span>
<span id="cb138-8"><a href="practical-generalised-linear-models.html#cb138-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> gender)</span></code></pre></div>
<p><img src="Practicals-module_1_files/figure-html/glm-plot-1.png" width="3600" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="practical-multiple-regression.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Practicals-module_1.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
